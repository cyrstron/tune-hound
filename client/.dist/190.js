(self.webpackChunktune_hound_client=self.webpackChunktune_hound_client||[]).push([[190],{5190:(e,i,t)=>{"use strict";t.r(i),t.d(i,{connectSpotifySaga:()=>B});var n=t(4857),r=t(452),o=t(5079),y=t(2710),s=t(7946),c=t(9158),d=t(681);function*l(e){const[i,t]=yield(0,n.$6)([(0,n.Ys)(d.lK),(0,n.Ys)(d.zC)]);try{i?yield e.player.setVolume(0):yield e.player.setVolume(t/100)}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}var a=t(9362);function*u({payload:{isMuted:e}}){const i=yield(0,n.fw)(o.Py);try{if(e)yield i.player.setVolume(0);else{const e=yield(0,n.Ys)(d.zC);yield i.player.setVolume(e)}}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*f(){yield(0,n.ib)(a.mb,u)}function*p({payload:{volume:e}}){const i=yield(0,n.fw)(o.Py);try{yield i.player.setVolume(e/100)}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*k(){yield(0,n.P2)(500,a.FB,p)}var Y=t(3896);function*h(){const e=yield(0,n.fw)(o.Py),i=yield(0,n.Ys)(d.HS);if("spotify"!==i?.source)return;const[t,s]=yield(0,n.$6)([(0,n.Ys)(y.nQ),(0,n.Ys)(y.LK)]);try{if(t&&t.id===i.trackSource.id)yield e.player.resume();else{const t=yield(0,n.RE)(Y.C);yield e.api.playTrackById(s,i.trackSource.id,t)}}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*g(){yield(0,n.ib)(a.NH,h)}function*w(){const e=yield(0,n.fw)(o.Py);if("spotify"===(yield(0,n.Ys)(d.AW)))try{yield e.player.pause()}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*_(){yield(0,n.ib)(a.E7,w)}function*z({payload:{position:e}}){const i=yield(0,n.fw)(o.Py),t=yield(0,n.Ys)(d.HS);if("spotify"===t?.source)try{yield i.player.seek(e*t.duration*10)}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*v(){yield(0,n.ib)(a.tG,z)}function*m({payload:{track:e,isAutoplay:i}}){const t=yield(0,n.fw)(o.Py);if("spotify"!==e.source)return;const[s,c]=yield(0,n.$6)([(0,n.Ys)(y.nQ),(0,n.Ys)(y.LK)]);try{if(s&&s.id===e.trackSource.id)i?(yield t.player.seek(0),yield t.player.resume()):(yield t.player.seek(0),yield t.player.pause());else{const i=yield(0,n.RE)(Y.C);yield t.api.playTrackById(c,e.trackSource.id,i)}}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*C(){yield(0,n.ib)(a.Ps,m)}function*$(){yield(0,n.Cs)(f),yield(0,n.Cs)(k),yield(0,n.Cs)(g),yield(0,n.Cs)(_),yield(0,n.Cs)(C),yield(0,n.Cs)(v)}var S=t(797);function*L(e){for(;;){const i=yield(0,n.qn)(e);if("object"==typeof i&&"type"in i&&i.type===S.uR.type)return;console.log(i)}}function*R(e){for(;;){const i=yield(0,n.qn)(e);if("object"==typeof i&&"type"in i)return;const{instance:t,isReady:s}=i,c=t.device_id,[d,l,a,u,f]=yield(0,n.$6)([(0,n.fw)(o.Py),(0,n.Ys)(y.mP),(0,n.Ys)(y.Wu),(0,n.Ys)(y.Wu),(0,n.Ys)(y.Xc),(0,n.Ys)(y.LK)]);try{!l||a||!u||f&&f===c||(yield d.setActiveDevice(c,u))}catch{}const p=(0,r.Zd)(t,s);yield(0,n.gz)(p)}}var E=t(3493),b=t.n(E);function*P(e,i){const t=yield(0,n.Ys)(d.HS);if(!t||"spotify"!==t.source||t.trackSource.id!==i?.id)try{yield e.player.pause()}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}var G=t(1878);function*H(e,i){const[t,o,s]=yield(0,n.$6)([(0,n.Ys)(d.HS),(0,n.Ys)(d.sd),(0,n.Ys)(y.nQ)]),c="spotify"===t?.source&&s&&s.id===t.trackSource.id;if(c&&i!==o){const e=(0,G.sB)(i);yield(0,n.gz)(e)}else if(i&&!c&&!o)try{yield e.player.pause()}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*q(e,i){const[t,o]=yield(0,n.$6)([(0,n.Ys)(d.HS),(0,n.Ys)(d.sd)]);if("spotify"===t?.source&&o){const e=(0,G.wq)(i?i/(1e3*t.duration)*100:0);yield(0,n.gz)(e)}else try{yield e.player.pause()}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}}function*V(e){if("spotify"!==(yield(0,n.Ys)(d.AW)))return;try{yield e.player.pause()}catch(e){const i=(0,r.k$)(e);yield(0,n.gz)(i)}const i=(0,G.vR)();yield(0,n.gz)(i)}function*A(e,i){const t=yield i.getState(),o=(0,r.P9)(t);for(yield(0,n.gz)(o);;){const t=yield(0,n.qn)(e);if(t&&"object"==typeof t&&"type"in t)return;const o=yield(0,n.Ys)(y.nI);o?.paused!==t?.paused&&(yield(0,n.RE)(H,i,!!t&&!t.paused)),o?.position!==t?.position&&(yield(0,n.RE)(q,i,t?.position)),o?.track_window.current_track.id!==t?.track_window.current_track.id&&(yield(0,n.RE)(P,i,t?.track_window.current_track)),o?.track_window.previous_tracks[0]?.id===t?.track_window.current_track.id&&o&&o.position<200&&(yield(0,n.RE)(V,i));const s=(0,r.P9)(t);yield(0,n.gz)(s)}}function*I(e){const i=(0,S.GG)((i=>(e.initPlayer((e=>{i(e)})),()=>{})));for(;;){const e=yield(0,n.qn)(i),[t,r]=yield(0,n.$6)([(0,n.Ys)(y.aI),(0,n.Ys)(y.xQ)]);if("object"==typeof e)return;if(!t)return void e();r&&(yield(0,n.RE)(c.Y)),e(yield(0,n.Ys)(y.Xc))}}function*Q(e){if(!(yield(0,n.Ys)(y.pF))){yield(0,n.Cs)(I,e);const i=(0,r.Vh)(!0);yield(0,n.gz)(i)}const i=function(e){const{player:i}=e;if(!i)throw new Error("Spotify player wasn't mounted");return(0,S.GG)((e=>(i.addListener("initialization_error",e),i.addListener("authentication_error",e),i.addListener("account_error",e),i.addListener("playback_error",e),()=>{i.removeListener("initialization_error",e),i.removeListener("authentication_error",e),i.removeListener("account_error",e),i.removeListener("playback_error",e)})))}(e),t=function(e){const{player:i}=e;if(!i)throw new Error("Spotify player wasn't mounted");return(0,S.GG)((e=>{const t=i=>{e({instance:i,isReady:!0})},n=i=>{e({instance:i,isReady:!1})};return i.addListener("ready",t),i.addListener("not_ready",n),()=>{i.removeListener("ready",t),i.removeListener("not_ready",n)}}))}(e),o=function(e){const{player:i}=e;if(!i)throw new Error("Spotify player wasn't mounted");return(0,S.GG)((e=>{const t=b()((i=>{e(i)}),200);return i.addListener("player_state_changed",t),()=>{i.removeListener("player_state_changed",t)}}))}(e);return yield(0,n.$6)([(0,n.Cs)(L,i),(0,n.Cs)(R,t),(0,n.Cs)(A,o,e)]),{errorsChannel:i,readyChannel:t,stateChannel:o}}function*j(e){yield(0,n.RE)(l,e);const i=yield(0,n.RE)(Q,e);return yield e.connect(),yield(0,n.Cs)($),i}function*B(){const e=(0,r.qv)();yield(0,n.gz)(e);const[i,t,d]=yield(0,n.$6)([(0,n.fw)(o.Py),(0,n.Ys)(y.aI),(0,n.Ys)(y.xQ)]);try{if(t)d&&(yield(0,n.RE)(c.Y));else{const e=yield i.api.login(),t=(0,r.hl)(e);(0,s.at)(e),yield(0,n.gz)(t)}const e=yield(0,n.Ys)(y.Xc),o=yield i.api.getCurrentUser(e),l=(0,r.pS)(o);if(yield(0,n.gz)(l),!(yield(0,n.Ys)(y.oA))){yield i.mount();const e=(0,r.hd)();yield(0,n.gz)(e)}const a=yield(0,n.RE)(j,i),u=(0,r.ZH)();return yield(0,n.gz)(u),a}catch(e){const i=(0,r.h6)(e);return void(yield(0,n.gz)(i))}}}}]);